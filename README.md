# SmartHome Web Server

![Smart Home](https://github.com/MaksBerkutov/PhpAssistent/blob/main/git-files/image/logo.png) 

## Описание

SmartHome Web Server — это мощное решение для управления вашим умным домом с помощью модулей ESP8266, ESP32. Этот проект позволяет пользователям контролировать и автоматизировать различные устройства в их доме через веб-интерфейс, обеспечивая простоту и удобство.

## Особенности

- **Управление устройствами**: Легко подключайте и управляйте различными устройствами, такими как лампочки, датчики, термостаты и многое другое.
- **Интуитивно понятный интерфейс**: Удобный веб-интерфейс, который позволяет пользователям быстро и просто управлять своими устройствами.
- **Мониторинг состояния**: Следите за состоянием ваших устройств в реальном времени.
- **Поддержка сценариев**: Создавайте и настраивайте сценарии автоматизации для управления устройствами на основе определенных условий.
- **Расширяемость**: Легко добавляйте новые модули и устройства в систему.

## Установка

1. Клонируйте репозиторий:

    ```bash
    git clone https://github.com/MaksBerkutov/PhpAssistent.git
    ```

2. Установите все необходимые зависимости:

    ```bash
    cd PhpAssistent
    composer install
    ```
3. Настройте параметры вашего сервера в файле `.env`.
   - укажите поли с AES ключом `AES=YOUR_AES_KEY`
   - вставьте строчку `INILIZATION_COMMAND=SERV_GAI`
   - Настройте SMTP
   ```
    MAIL_MAILER=smtp
    MAIL_HOST=YOUR_HOST
    MAIL_PORT=PORT
    MAIL_USERNAME=USERNAME
    MAIL_PASSWORD=PASSWORD
    MAIL_ENCRYPTION=ssl
    MAIL_FROM_ADDRESS=ADRESS
    MAIL_FROM_NAME="${APP_NAME}"
   ```
   - Настройте подключение к локальной БД
    ```
    DB_CONNECTION=mysql
    DB_HOST=HOST
    DB_PORT=3306
    DB_DATABASE=BD_NAME
    DB_USERNAME=USERNAME
    DB_PASSWORD=PASSWORD
   ```
4. Настройте **Apache2** на ваш локальный ip адрес.
## Использование

После успешной установки и запуска сервера, откройте веб-браузер и перейдите по адресу:

```
http://YOUR_IP/login
```

Здесь вы сможете войти или создать свою учетную запись и начать управлять своими устройствами.
## Использование
Создайте учётную запись или войдите в заранее созданную.
### Добавление модуля
1) Используя меню перейдите на пункт "Добавить модуль" (`/devices/create`).
2) Введите в поле с именем желаемое имя устройство (используется только для графической части для логической используется имя указанное непосредственно в прошивке).
3) Введите заранее подготовленный IP в поле с URL.
4) Если вы получили ошибку `Плата отклонила соеденение` значит в EEPROM модуля уже есть записанный IP который не совпадает с IP сервера.
    1) Создайте пост запрос на ваш модуль по пути `http://IP_MODULE/clear` если в ответ вы получите статус 200 значит всё прошло корректно если нет обновите прошивку модуля.  
    2) Заново попробуйте добавить модуль.
5) При успешном добавлении вы попадёте на страницу `/devices` в котором будет добавленный модуль.
### Управление модулем
1) Используя меню перейдите на пункт "Модули" (`/devices`).
2) На странице будут отображены все добавленные модули.
3) Первым полем карточки будет графическое имя и статус устройства (Онлайн/Офлайн).
4) Синее или серые кнопки - это кнопки действия заставляют модуль что-то сделать. Например: открыть реле.
5) Зелёные кнопки - это те кнопки которые возвращают результат в виде ключ-значения.
6) Выбора бинарного файла обновления (если в модуле включено ОТА обновление).
7) Кнопка запуска обновления.
### Cценарии
Сценарии - это пользовательские алгоритмы обработки массива данных приходящих с модулей.
Модули имеют возможность не только обрабатывать запросы сервера, но так же не зависимо от сервера уведомлять его об изменениях заданных программистом в прошивке.
Это работает очень просто в прошивке мы указываем условие триггер допустим температура выше 40 градусов. При выполнении заданного условия отправляем сообщение со значением(ями). В нашем случае (`"temp":"TEMP_FROM_SENSOR"`).
На модуле мы создаём обработчик триггера, в нашем случае ключ будет `temp` значение `40`. Так же нужно указать модуль который должен прислать данные и сценарий обработки их всего 5.
 - Логировать данные.
 - Запись в базу данных.
 - Отправить уведомление.
 - Изменить состояние модуля.
 - отправить на внешний API.
### Добавление сценария 
1) В поле модуль выберите из списка нужный модуль.
2) В поле ключ укажите название ключа к примеру `temp`.
3) В поле значение укажите желаемое значение к примеру `40`.
4) Выберите одно/несколько действий для сценария 
   1) Логировать данные.
      - В поле `Формат строки лога` укажите как выводить данные. К примеру `Температура с сенсора {key} привсила значение 40 температура сейчас [{value}]`.
   2) Запись в базу данных.
      - Укажите данные для подключения к базе данных.
      - Укажите SQL команду для вставки данных.
   3) Отправить уведомление.
         - В поле `Сообщение для уведомления` укажите как выводить данные. К примеру `Температура с сенсора {key} привсила значение 40 температура сейчас [{value}]`.
         - В поле `Статус` укажите статус уведомления. К примеру `Уведомление`.
   4) Изменить состояние модуля.
        - Из списка `Выберите модуль` выберите нужный модуль.
        - Из списка `Выберите команду` выберите нужную команду.
   5) Отправить на внешний API.
        - Введите URL сайта к примеру `https://mytest.com/api/module`.
        - Введите формат запроса сайта к примеру `{data:{"{key}":"{data}"}}`.
5) Нажмите на кнопку создать сценарий.
### Управление сценариями
## Ссылки
- **[ESP Libary](https://github.com/MaksBerkutov/AssistentLibary)**

    
## Лицензия
Этот проект лицензируется на условиях MIT License. 

## Контакты

**Maks Berkutov**

- [Telegram](https://t.me/i37Holodok73i)
- [GitHub](https://github.com/MaksBerkutov)
- [Email](mailto:0701200maks@gmail.com)
